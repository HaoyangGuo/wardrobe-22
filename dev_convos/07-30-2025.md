users (
  id              uuid  primary key,
  username        text  unique not null,
  aws_cognito_id  text  unique not null,
  created_at      timestamptz default now(),
  updated_at      timestamptz default now()
);

user_settings (
  user_id         uuid  primary key references users(id),
  watermark_text  text  default 'wardrobe 22',
  created_at      timestamptz default now(),
  updated_at      timestamptz default now()
);

tags (
  id         uuid primary key,
  name       text not null,
  owner_id   uuid references users(id),
  created_at timestamptz default now(),
  updated_at timestamptz default now(),
  unique(name, owner_id)
);

garments (
  id         uuid primary key,
  user_id    uuid references users(id),
  name       text,
  image_key  text,
  created_at timestamptz default now(),
  updated_at timestamptz default now()
);

garment_tags (
  garment_id uuid references garments(id),
  tag_id     uuid references tags(id),
  primary key (garment_id, tag_id)
);

outfits (
  id         uuid primary key,
  user_id    uuid references users(id),
  name       text,
  layout     jsonb,
  created_at timestamptz default now(),
  updated_at timestamptz default now(),
  version    int default 1
);

outfit_tags (
  outfit_id  uuid references outfits(id),
  tag_id     uuid references tags(id),
  primary key (outfit_id, tag_id)
);

outfit_garments (
  outfit_id  uuid references outfits(id),
  garment_id uuid references garments(id),
  x          double precision,
  y          double precision,
  scale      double precision default 1,
  rotation   double precision default 0,
  z_index    int default 0,
  primary key (outfit_id, garment_id)
);
